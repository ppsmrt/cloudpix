<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CloudPix Admin</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
body{font-family:'Inter',sans-serif;background:#f8fafc;margin:0;color:#111;}
header{background:#fff;padding:16px;text-align:center;font-weight:bold;font-size:20px;box-shadow:0 2px 6px rgba(0,0,0,0.08);}
main{max-width:1000px;margin:20px auto;padding:0 16px;}
.card{background:#fff;border-radius:16px;padding:20px;box-shadow:0 8px 24px rgba(0,0,0,0.05);}
.table{width:100%;border-collapse:collapse;}
.table th,.table td{padding:12px;border-bottom:1px solid #e5e7eb;text-align:left;}
.table th{background:#f1f5f9;}
.btn{padding:6px 12px;border-radius:10px;font-weight:600;cursor:pointer;transition:.2s;}
.btn-delete{background:#ef4444;color:white;}
.btn-copy{background:#3b82f6;color:white;}
.toast-wrap{position:fixed;right:16px;bottom:40px;display:flex;flex-direction:column;gap:10px;z-index:60;}
.toast{padding:10px 14px;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,0.1);color:white;font-weight:600;}
footer{text-align:center;padding:16px;font-size:14px;color:#6b7280;margin-top:30px;}
</style>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp, getDocs, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAlLV6zJ1PPGRmpkVNYuN3q0WTTEvMoiTo",
  authDomain: "cldpix.firebaseapp.com",
  projectId: "cldpix",
  storageBucket: "cldpix.firebasestorage.app",
  messagingSenderId: "476804020281",
  appId: "1:476804020281:web:820fbe12d8720e575fb5e8"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
</script>

</head>
<body>
<header>CloudPix Admin Panel</header>

<main>
  <div class="card">
    <h2 class="text-lg font-semibold mb-4">Manage Uploaded Images</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Preview</th>
          <th>File Name</th>
          <th>Uploaded</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="image-table"></tbody>
    </table>
  </div>
</main>

<footer>&copy; 2025 CloudPix. All rights reserved.</footer>
<div class="toast-wrap" id="toasts"></div>

<script type="module">
const imageTable=document.getElementById('image-table');
const toasts=document.getElementById('toasts');

function showToast(msg,type='info'){
  const el=document.createElement('div');
  el.className='toast';
  el.style.background=type==='success'?'#10b981':type==='error'?'#ef4444':'#3b82f6';
  el.textContent=msg;
  toasts.appendChild(el);
  setTimeout(()=>el.remove(),3000);
}

let uploads=[];

async function fetchUploads(){
  const q = query(collection(db,"uploads"), orderBy("time","desc"));
  const snapshot = await getDocs(q);
  uploads = snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));
  renderTable();
}

function renderTable(){
  imageTable.innerHTML='';
  uploads.forEach((item,index)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td><img src="${item.url}" class="w-20 h-20 object-cover rounded"/></td>
      <td>${item.name}</td>
      <td>${item.time?new Date(item.time.seconds*1000).toLocaleString():'-'}</td>
      <td class="flex gap-2">
        <button class="btn btn-copy">Copy Link</button>
        <button class="btn btn-delete">Delete</button>
      </td>
    `;
    tr.querySelector('.btn-copy').addEventListener('click',()=>{
      const mockupUrl=`https://ppsmrt.github.io/cloudpix?img=${encodeURIComponent(item.url)}`;
      navigator.clipboard.writeText(mockupUrl);
      showToast('Mockup link copied','success');
    });
    tr.querySelector('.btn-delete').addEventListener('click',async ()=>{
      if(confirm('Delete this image?')){
        try{
          await deleteDoc(doc(db,'uploads',item.id));
          uploads.splice(index,1);
          renderTable();
          showToast('Deleted','success');
        }catch(e){ console.error(e); showToast('Delete failed','error'); }
      }
    });
    imageTable.appendChild(tr);
  });
}

fetchUploads();
</script>
</body>
</html>
