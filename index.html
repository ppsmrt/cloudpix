<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CloudPix — Premium Image Host</title>

<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet"/>

<style>
body { font-family:'Inter',sans-serif; margin:0; background:#f8fafc; color:#111; }
header { background:#fff; padding:16px; text-align:center; font-weight:bold; font-size:22px; box-shadow:0 2px 6px rgba(0,0,0,0.08);}
main { max-width:920px; margin:20px auto; padding:0 16px; }
.card { background:#fff; border-radius:16px; padding:20px; box-shadow:0 8px 24px rgba(0,0,0,0.05); }
.btn { padding:10px 16px; border-radius:10px; font-weight:600; display:inline-flex; gap:8px; align-items:center; cursor:pointer; transition:.2s; }
.btn-primary{ background:linear-gradient(90deg,#7c3aed,#06b6d4); color:white; }
.btn-ghost { background:transparent; border:1px solid #d1d5db; color:#111; }
.progress { height:10px; background:#e5e7eb; border-radius:999px; overflow:hidden; margin-top:10px; }
.progress > div { height:100%; width:0%; background:linear-gradient(90deg,#06b6d4,#7c3aed); transition:width .2s linear; }
.gallery { display:grid; grid-template-columns: repeat(auto-fill,minmax(160px,1fr)); gap:12px; margin-top:14px; }
.tile { border-radius:12px; overflow:hidden; position:relative; background:#f3f4f6; min-height:140px; display:flex;align-items:center;justify-content:center; cursor:pointer; transition: all .25s; }
.tile img { width:100%; height:100%; object-fit:cover; display:block; transition: transform .35s ease; }
.tile:hover img { transform:scale(1.05); }
.tile:hover { box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
.tile .btn { font-size:0.75rem; padding:4px 6px; }
.tooltip { position:absolute; bottom:100%; left:50%; transform:translateX(-50%); background:#111; color:white; font-size:10px; padding:2px 6px; border-radius:4px; white-space:nowrap; opacity:0; transition:.2s; pointer-events:none; }
.tile:hover .tooltip { opacity:1; }
#mini-preview { display:grid; grid-template-columns: repeat(auto-fill,minmax(100px,1fr)); gap:8px; margin-top:10px; }
.toast-wrap { position: fixed; right:18px; bottom:40px; z-index:90; display:flex; flex-direction:column; gap:10px; align-items:flex-end; }
.toast { padding:10px 14px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.2); color:white; font-weight:600; opacity:0; transform: translateX(50px); animation: slideIn 0.3s forwards; }
@keyframes slideIn { to { opacity:1; transform: translateX(0); } }
footer { text-align:center; padding:16px; font-size:14px; color:#6b7280; margin-top:30px; }
</style>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAlLV6zJ1PPGRmpkVNYuN3q0WTTEvMoiTo",
  authDomain: "cldpix.firebaseapp.com",
  projectId: "cldpix",
  storageBucket: "cldpix.firebasestorage.app",
  messagingSenderId: "476804020281",
  appId: "1:476804020281:web:820fbe12d8720e575fb5e8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
</script>

</head>
<body>
<header>CloudPix</header>

<main>
  <div class="card" id="upload-card">
    <h2 class="text-2xl font-semibold mb-3">Upload Image</h2>
    <p class="mb-2 text-sm text-gray-500">Select one or more images to upload. Each image will automatically get a heading and description.</p>
    <p class="mb-4 text-gray-600">Drag & drop or choose an image (PNG, JPG, WEBP — max 10MB).</p>

    <input type="file" id="file-input" accept="image/*" class="hidden" multiple/>
    <label for="file-input" class="btn btn-ghost"><i class="fa-solid fa-folder-open"></i> Browse File</label>
    
    <div class="mt-4 progress"><div id="progress-bar"></div></div>
    <div id="status-text" class="text-sm text-gray-500 mt-1">No file selected</div>

    <button id="upload-now" class="btn btn-primary mt-3 hidden"><i class="fa-solid fa-cloud-upload-alt"></i> Upload</button>

    <div id="mini-preview"></div>
  </div>

  <div class="card mt-6">
    <h3 class="text-lg font-semibold mb-3">Recent Uploads</h3>
    <div id="gallery" class="gallery"></div>
  </div>
</main>

<footer>&copy; 2025 CloudPix. All rights reserved.</footer>

<div class="toast-wrap" id="toasts"></div>

<script type="module">
const imgbbKey = '8604e4b4050c63c460d0bca39cf28708';
const fileInput = document.getElementById('file-input');
const uploadNowBtn = document.getElementById('upload-now');
const progressBar = document.getElementById('progress-bar');
const statusText = document.getElementById('status-text');
const miniPreview = document.getElementById('mini-preview');
const gallery = document.getElementById('gallery');
const toasts = document.getElementById('toasts');

let currentFiles = [];
let uploads = [];

function showToast(msg,type='info'){
  const el=document.createElement('div');
  el.className='toast';
  el.style.background = type==='success'?'#10b981':type==='error'?'#ef4444':'#3b82f6';
  el.textContent=msg;
  toasts.appendChild(el);
  setTimeout(()=>el.remove(),3000);
}

function generateHeading(filename){
  const name = filename.replace(/\.[^/.]+$/, "");
  return name.replace(/[-_]/g, " ").replace(/\b\w/g, l => l.toUpperCase());
}

function generateDescription(heading){
  return `A beautiful image of ${heading} uploaded to CloudPix.`;
}

// Drag & drop
const uploadCard = document.getElementById('upload-card');
uploadCard.addEventListener('dragover', e=>{ e.preventDefault(); uploadCard.classList.add('border-2','border-dashed','border-indigo-400'); });
uploadCard.addEventListener('dragleave', e=>{ e.preventDefault(); uploadCard.classList.remove('border-2','border-dashed','border-indigo-400'); });
uploadCard.addEventListener('drop', e=>{
  e.preventDefault(); uploadCard.classList.remove('border-2','border-dashed','border-indigo-400');
  handleFiles(e.dataTransfer.files);
});

fileInput.addEventListener('change', e=>{ handleFiles(e.target.files); });

function handleFiles(files){
  miniPreview.innerHTML = "";
  currentFiles = [];
  Array.from(files).forEach(file=>{
    if(file.type.startsWith('image/')){
      if(file.size > 10*1024*1024){ showToast('File too large','error'); return; }
      currentFiles.push(file);
      const heading = generateHeading(file.name);
      const description = generateDescription(heading);
      const reader = new FileReader();
      reader.onload = e=> {
        const div = document.createElement('div');
        div.className='tile w-28 h-32 flex flex-col';
        div.innerHTML = `<img src="${e.target.result}" class="w-full h-20 object-cover rounded"/>
                         <h4 class="text-sm font-semibold mt-1 truncate">${heading}</h4>
                         <p class="text-xs text-gray-500 truncate">${description}</p>`;
        miniPreview.appendChild(div);
      };
      reader.readAsDataURL(file);
    } else showToast('Select image files only','error');
  });
  if(currentFiles.length>0) uploadNowBtn.classList.remove('hidden');
}

uploadNowBtn.addEventListener('click', ()=>{ if(currentFiles.length>0) uploadFiles(currentFiles); else showToast('No files selected','error'); });

async function uploadFiles(files){
  progressBar.style.width='0%';
  statusText.textContent='Uploading...';
  uploadNowBtn.classList.add('hidden');

  for(const file of files){
    const form = new FormData();
    form.append('image',file);
    const xhr = new XMLHttpRequest();
    xhr.open('POST', `https://api.imgbb.com/1/upload?key=${imgbbKey}`);
    
    xhr.upload.onprogress = e=>{
      if(e.lengthComputable){
        const pct = Math.round((e.loaded/e.total)*100);
        progressBar.style.width=pct+'%';
        statusText.textContent=`Uploading ${file.name} — ${pct}%`;
      }
    };

    await new Promise((resolve)=>{
      xhr.onreadystatechange=async ()=>{
        if(xhr.readyState===4){
          try{
            const res=JSON.parse(xhr.responseText);
            if(res && res.success){
              const url=res.data.url;
              const mockupUrl = `https://ppsmrt.github.io/cloudpix?img=${encodeURIComponent(url)}`;
              showToast(`${file.name} uploaded`,'success');
              const heading = generateHeading(file.name);
              const description = generateDescription(heading);
              addToGallery({url,name:file.name,heading,description,mockupUrl});
              await addDoc(collection(db,'uploads'),{name:file.name,url:url,heading,description,time:serverTimestamp()});
            } else showToast(`${file.name} failed`,'error');
          } catch(e){ console.error(e); showToast(`${file.name} error`,'error'); }
          resolve();
        }
      };
      xhr.onerror=()=>{ showToast('Network error','error'); resolve(); };
      xhr.send(form);
    });
  }

  currentFiles=[];
  miniPreview.innerHTML='';
  statusText.textContent='Upload complete';
  progressBar.style.width='0%';
  uploadNowBtn.classList.add('hidden');
}

function addToGallery(item){
  uploads.unshift(item);
  const tile=document.createElement('div');
  tile.className='tile';
  tile.innerHTML = `<img src="${item.url}" alt="${item.name}" loading="lazy"/>
                    <div class="absolute top-1 right-1 flex gap-1">
                      <button class="btn btn-primary btn-sm copy"><i class="fa-solid fa-link"></i>
                        <span class="tooltip">Copy Mockup URL</span>
                      </button>
                      <a href="${item.url}" download class="btn btn-ghost btn-sm"><i class="fa-solid fa-download"></i>
                        <span class="tooltip">Download Original</span>
                      </a>
                    </div>`;
  tile.querySelector('.copy').addEventListener('click', ()=>{
    navigator.clipboard.writeText(item.mockupUrl);
    showToast('Mockup link copied','success');
  });
  gallery.prepend(tile);
}

// Load recent uploads from Firestore
async function loadRecentUploads(){
  const q = query(collection(db,'uploads'), orderBy('time','desc'), limit(20));
  const snapshot = await getDocs(q);
  snapshot.forEach(doc=>{
    const data = doc.data();
    data.mockupUrl = `https://ppsmrt.github.io/cloudpix?img=${encodeURIComponent(data.url)}`;
    addToGallery(data);
  });
}

loadRecentUploads();
</script>
</body>
</html>
